<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Preguntas y Respuestas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="iste.png" type="image/png">
</head>
<body>
    <div class="container">
        <h1>COMPLETO</h1>
        <label for="topic"></label>
        <select id="topic" name="topic">
            <option value="all">Exmen Complv</option>
        </select>

        <form id="questionForm">
            <label for="question">Buscar pregunta:</label>
            <input type="text" id="question" placeholder="Ingrese su pregunta del examen aquí" required>
            <button type="button" id="updateButton">Reset</button>
            <button type="submit">Buscar</button>

            <div id="suggestionsContainer"></div>
        </form>

        <div id="answerContainer"></div>

        <script>
            function removeAccents(str) {
                return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            }

            function normalizeQuestion(question) {
                let normalized = question.replace(/[¿?.,:;!"1234567890]/g, '').toLowerCase().trim();
                normalized = removeAccents(normalized);
                normalized = normalized.replace(/\s+/g, ' '); // Reemplaza múltiples espacios o tabulaciones por un solo espacio
                return normalized;
            }

            function procesarPreguntasYRespuestas(data, question, answerContainer) {
                const normalizedQuestion = normalizeQuestion(question);

                let questionFound = false;
                let answerHTML = '';
                Object.keys(data).forEach(key => {
                    const normalizedStoredQuestion = normalizeQuestion(data[key].question);

                    if (normalizedStoredQuestion.includes(normalizedQuestion)) {
                        questionFound = true;
                        answerHTML += `<h2>${data[key].question}</h2><ul>`;
                        data[key].answers.forEach(answer => {
                            const isCorrect = answer.includes("");
                            if (isCorrect) {
                                answerHTML += `<li class="correct-answer">${answer}</li>`;
                            } else {
                                answerHTML += `<li>${answer}</li>`;
                            }
                        });
                        answerHTML += '</ul>';
                    }
                });

                if (!questionFound) {
                    answerHTML = "<p>No se encontró una respuesta para esa pregunta o tema.</p>";
                }
                answerContainer.innerHTML = answerHTML;
            }

            function mostrarSugerencias(suggestions) {
                const suggestionsContainer = document.getElementById('suggestionsContainer');
                suggestionsContainer.innerHTML = '';

                const limitedSuggestions = suggestions.slice(0, 5);

                if (limitedSuggestions.length > 0) {
                    suggestionsContainer.style.display = 'block'; // Mostrar el contenedor de sugerencias
                    limitedSuggestions.forEach(suggestion => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.textContent = suggestion;
                        div.addEventListener('click', () => {
                            document.getElementById('question').value = suggestion;
                            suggestionsContainer.innerHTML = '';
                            document.getElementById('questionForm').dispatchEvent(new Event('submit'));
                        });
                        suggestionsContainer.appendChild(div);
                    });
                } else {
                    suggestionsContainer.style.display = 'none'; // Ocultar el contenedor si no hay sugerencias
                }
            }

            function cargarPreguntasYRespuestas() {
                return fetch('preguntas_respuestas.json')
                    .then(response => response.json())
                    .catch(error => console.error('Error al cargar el archivo JSON:', error));
            }

            document.getElementById('question').addEventListener('input', function() {
                const question = this.value;
                const topic = document.getElementById('topic').value;

                cargarPreguntasYRespuestas().then(data => {
                    const suggestions = [];
                    Object.keys(data).forEach(key => {
                        const normalizedStoredQuestion = normalizeQuestion(data[key].question);
                        if (normalizedStoredQuestion.includes(normalizeQuestion(question))) {
                            suggestions.push(data[key].question);
                        }
                    });
                    mostrarSugerencias(suggestions);
                });
            });

            document.getElementById('questionForm').addEventListener('submit', function(event) {
                event.preventDefault();

                const question = document.getElementById('question').value;
                const topic = document.getElementById('topic').value;
                const answerContainer = document.getElementById('answerContainer');

                cargarPreguntasYRespuestas().then(data => {
                    procesarPreguntasYRespuestas(data, question, answerContainer);
                });
            });

            document.getElementById('updateButton').addEventListener('click', function() {
                document.getElementById('question').value = '';
                document.getElementById('suggestionsContainer').style.display = 'none'; // Ocultar el contenedor de sugerencias
                document.getElementById('answerContainer').innerHTML = ''; // Limpiar respuestas
            });

            const inactivityTime = 10 * 60 * 1000;
            let timer;

            function redirectToLogin() {
                window.location.href = "index.html";
            }

            function resetTimer() {
                clearTimeout(timer);
                timer = setTimeout(redirectToLogin, inactivityTime);
            }

            document.addEventListener("mousemove", resetTimer);
            document.addEventListener("keydown", resetTimer);

            timer = setTimeout(redirectToLogin, inactivityTime);
        </script>
    </div>
</body>
</html>
