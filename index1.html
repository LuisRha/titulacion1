<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Preguntas y Respuestas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="iste.png" type="image/png">
    <style>
        /* Añade estilos para el contenedor de sugerencias */
        #suggestionsContainer {
            border: 1px solid #ddd;
            padding: 5px;
            margin-top: 5px;
            max-height: 150px;
            overflow-y: auto;
        }

        .suggestion-item {
            padding: 5px;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background-color: #f0f0f0;
        }

        .correct-answer {
            color: green;
        }
    </style>
</head>
<body>
    <div>
        <h1>Web En Proceso</h1>
        <!-- Agregamos un campo de selección para elegir el tema -->
        <label for="topic">Tema:</label>
        <select id="topic" name="topic">
            <option value="all">Exmn Complexivo</option>
            <!-- <option value="primer-parcial">Primer Parcial DAW 5to</option>
            <option value="segundo-parcial">Segundo Parcial Quinto Semestre</option>
            <option value="tercer-parcial">Tercer Parcial Quinto Semestre</option> -->
            <!-- Puedes agregar más opciones de temas aquí -->
        </select>

        <h2>Consulta de Preguntas y Respuestas</h2>

        <!-- Formulario para buscar una pregunta -->
        <form id="questionForm">
            <label for="question">Buscar pregunta:</label>
            <input type="text" id="question" placeholder="Ingrese su pregunta del examen aquí" required>
           
            <button type="button" id="updateButton">Reset</button>
            <button type="submit">Buscar</button>

            <div id="suggestionsContainer"></div> <!-- Contenedor para sugerencias -->

    
        </form>

        <!-- Contenedor para mostrar la respuesta -->
        <div id="answerContainer"></div>

        <script>
            function removeAccents(str) {
                return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            }

            function procesarPreguntasYRespuestas(data, question, answerContainer) {
                // Normalizar la pregunta eliminando signos de puntuación y tildes
                const normalizedQuestion = removeAccents(question.replace(/[¿?.,:;!"1234567890]/g, '').toLowerCase().trim());

                let questionFound = false;
                let answerHTML = '';
                Object.keys(data).forEach(key => {
                    // Normalizar la pregunta en el archivo JSON
                    const normalizedStoredQuestion = removeAccents(data[key].question.replace(/[¿?.,:;!"1234567890]/g, '').toLowerCase().trim());

                    if (normalizedStoredQuestion.includes(normalizedQuestion)) {
                        questionFound = true;
                        answerHTML += `<h2>${data[key].question}</h2><ul>`;
                        // Recorremos las respuestas de la pregunta
                        data[key].answers.forEach(answer => {
                            // Verificamos si esta respuesta está marcada como correcta
                            const isCorrect = answer.includes("");
                            // Si es correcta, la resaltamos
                            if (isCorrect) {
                                answerHTML += `<li class="correct-answer">${answer}</li>`;
                            } else {
                                answerHTML += `<li>${answer}</li>`;
                            }
                        });
                        answerHTML += '</ul>';
                    }
                });

                if (!questionFound) {
                    // Si la pregunta no se encuentra en el objeto 'data', mostramos un mensaje de error
                    answerHTML = "<p>No se encontró una respuesta para esa pregunta o tema.</p>";
                }
                answerContainer.innerHTML = answerHTML;
            }

            function mostrarSugerencias(suggestions) {
                const suggestionsContainer = document.getElementById('suggestionsContainer');
                suggestionsContainer.innerHTML = '';
                
                // Limitar a 5 sugerencias
                const limitedSuggestions = suggestions.slice(0, 5);
                
                if (limitedSuggestions.length > 0) {
                    limitedSuggestions.forEach(suggestion => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.textContent = suggestion;
                        div.addEventListener('click', () => {
                            document.getElementById('question').value = suggestion;
                            suggestionsContainer.innerHTML = '';
                            document.getElementById('questionForm').dispatchEvent(new Event('submit')); // Dispara el formulario para buscar la pregunta seleccionada
                        });
                        suggestionsContainer.appendChild(div);
                    });
                }
            }

            function cargarPreguntasYRespuestas() {
                return fetch('preguntas_respuestas.json')
                    .then(response => response.json())
                    .catch(error => console.error('Error al cargar el archivo JSON:', error));
            }

            function cargarPreguntasYRespuestasPrimerParcial() {
                return fetch('primer_parcial.json')
                    .then(response => response.json())
                    .catch(error => console.error('Error al cargar el archivo JSON:', error));
            }

            document.getElementById('question').addEventListener('input', function() {
                const question = this.value;
                const topic = document.getElementById('topic').value;
                
                // Cargar las preguntas y respuestas según el tema
                const loadQuestions = topic === 'primer-parcial' ? cargarPreguntasYRespuestasPrimerParcial : cargarPreguntasYRespuestas;
                
                loadQuestions().then(data => {
                    const suggestions = [];
                    Object.keys(data).forEach(key => {
                        const normalizedStoredQuestion = removeAccents(data[key].question.replace(/[¿?.,:;!"1234567890]/g, '').toLowerCase().trim());
                        if (normalizedStoredQuestion.includes(removeAccents(question.replace(/[¿?.,:;!"1234567890]/g, '').toLowerCase().trim()))) {
                            suggestions.push(data[key].question);
                        }
                    });
                    mostrarSugerencias(suggestions);
                });
            });

            document.getElementById('questionForm').addEventListener('submit', function(event) {
                event.preventDefault(); // Evitar que el formulario se envíe automáticamente

                const question = document.getElementById('question').value;
                const topic = document.getElementById('topic').value; // Obtener el tema seleccionado
                const answerContainer = document.getElementById('answerContainer');

                // Verificar si el tema seleccionado es "primer-parcial"
                const loadQuestions = topic === 'primer-parcial' ? cargarPreguntasYRespuestasPrimerParcial : cargarPreguntasYRespuestas;

                loadQuestions().then(data => {
                    // Procesar las preguntas y respuestas según el tema
                    procesarPreguntasYRespuestas(data, question, answerContainer);
                });
            });

            // Función para actualizar la página
            document.getElementById('updateButton').addEventListener('click', function() {
                location.reload();
            });

            // Función para redirigir a la página de inicio de sesión después de un tiempo de inactividad
            const inactivityTime = 10 * 60 * 1000; // 10 minutos en milisegundos
            let timer;

            function redirectToLogin() {
                window.location.href = "index.html";
            }

            function resetTimer() {
                clearTimeout(timer);
                timer = setTimeout(redirectToLogin, inactivityTime);
            }

            document.addEventListener("mousemove", resetTimer);
            document.addEventListener("keydown", resetTimer);

            timer = setTimeout(redirectToLogin, inactivityTime);
        </script>
    </div>
</body>
</html>
